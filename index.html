<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Polymarket Dashboard</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 900px; margin: 40px auto; padding: 0 16px; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0; }
      .kpi { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
      .kpi div { background: #f7f7f7; padding: 12px; border-radius: 10px; }
      button { padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; background: white; cursor: pointer; }
      button.active { background: #1677ff; color: white; border-color: #1677ff; }
      pre { background: #111; color: #0f0; padding: 12px; border-radius: 12px; overflow: auto; }
    </style>
  </head>
  <body>
    <h1>Polymarket Dashboard</h1>

    <div class="card">
      <div>
        <button id="btn-day" class="active">天</button>
        <button id="btn-week">周</button>
        <button id="btn-month">月</button>
      </div>
      <p id="mode">当前：天</p>
    </div>

    <div class="card kpi">
      <div><b>活跃次数</b><div id="kpi-activity">-</div></div>
      <div><b>交易量(USDC)</b><div id="kpi-volume">-</div></div>
      <div><b>余额(USDC)</b><div id="kpi-balance">-</div></div>
    </div>

    <div class="card">
      <b>原始数据（调试用）</b>
      <pre id="raw">loading...</pre>
    </div>

    <script>
      let mode = "day";
      const btnDay = document.getElementById("btn-day");
      const btnWeek = document.getElementById("btn-week");
      const btnMonth = document.getElementById("btn-month");
      const modeText = document.getElementById("mode");

      function setActive(m) {
        mode = m;
        btnDay.classList.toggle("active", m === "day");
        btnWeek.classList.toggle("active", m === "week");
        btnMonth.classList.toggle("active", m === "month");
        modeText.textContent = "当前：" + (m === "day" ? "天" : m === "week" ? "周" : "月");
        load();
      }

      btnDay.onclick = () => setActive("day");
      btnWeek.onclick = () => setActive("week");
      btnMonth.onclick = () => setActive("month");

      async function load() {
        // 先读本地 json（下一部分我们会自动生成它们）
        const file = mode === "day" ? "daily" : mode === "week" ? "weekly" : "monthly";
        const [seriesRes, balRes] = await Promise.all([
          fetch("./data/" + file + ".json").catch(() => null),
          fetch("./data/balance.json").catch(() => null)
        ]);

        let series = [];
        let balance = null;

        if (seriesRes && seriesRes.ok) series = await seriesRes.json();
        if (balRes && balRes.ok) balance = await balRes.json();

        // KPI：取最新一条
        const last = series.length ? series[series.length - 1] : null;
        document.getElementById("kpi-activity").textContent = last ? last.activity : "-";
        document.getElementById("kpi-volume").textContent = last ? last.volume_usdc : "-";
        document.getElementById("kpi-balance").textContent = balance ? balance.usdc : "-";

        document.getElementById("raw").textContent = JSON.stringify({ mode, last, seriesTail: series.slice(-5), balance }, null, 2);
      }

      load();
    </script>
  </body>
</html>
